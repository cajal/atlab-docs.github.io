

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>DataJoint &mdash; atlab-docs 0.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Docker" href="docker.html" />
    <link rel="prev" title="Welcome to atlab-docs’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> atlab-docs
          

          
          </a>

          
            
            
              <div class="version">
                0.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">DataJoint</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#why-should-you-use-datajoint">Why Should You Use DataJoint?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installing-datajoint">Installing DataJoint</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-login-credentials">Setting Up Login Credentials</a></li>
<li class="toctree-l2"><a class="reference internal" href="#overview-of-the-basics-of-datajoint">Overview of the Basics of DataJoint</a></li>
<li class="toctree-l2"><a class="reference internal" href="#schema">Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="#table-definition">Table Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-types">Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="#external-storage">External Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#migrating-external-storage-from-v0-11-to-v0-12">Migrating External Storage from v0.11 to v0.12</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dj-manual">dj.Manual</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dj-computed">dj.Computed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#querying-tables">Querying Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#datajoint-parallelizing-dj-computed-populate">DataJoint Parallelizing dj.Computed Populate</a></li>
<li class="toctree-l2"><a class="reference internal" href="#other-resources">Other Resources:</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="kubernetes.html">Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="stimulus.html">Stimulus</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipeline.html">Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="stimulus_sync.html">Primer on stimulus syncing</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">atlab-docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>DataJoint</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/datajoint.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="datajoint">
<h1>DataJoint<a class="headerlink" href="#datajoint" title="Permalink to this headline">¶</a></h1>
<div class="section" id="why-should-you-use-datajoint">
<h2>Why Should You Use DataJoint?<a class="headerlink" href="#why-should-you-use-datajoint" title="Permalink to this headline">¶</a></h2>
<p>Datajoint is a python package created by Vathes to allow eaiser access and data pipeline creation without directly interfacing with a SQL Database which would require learning SQL commands as well as how to use the connector to send those queries to the database.</p>
<p>For example, let say we want to join two tables name table_1 and table_2 and get all the data from it:</p>
<p>In (SQL) this is the query we have to write which then get fed through connector package:</p>
<div class="highlight-SQL notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">table_1</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">table_2</span> <span class="k">ON</span> <span class="n">join_condition</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>On the other hand with DataJoint (python) all we need to do is write this line:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">table_1</span> <span class="o">*</span> <span class="n">table_2</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="installing-datajoint">
<h2>Installing DataJoint<a class="headerlink" href="#installing-datajoint" title="Permalink to this headline">¶</a></h2>
<p>Datajoint can be installed via pip3 or via Anaconda</p>
<p>pip3:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">pip3</span> <span class="n">install</span> <span class="n">datajoint</span>
</pre></div>
</td></tr></table></div>
<p>Anaconda:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">datajoint</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="setting-up-login-credentials">
<h2>Setting Up Login Credentials<a class="headerlink" href="#setting-up-login-credentials" title="Permalink to this headline">¶</a></h2>
<p>To get your datajoint login, please contact Daniel Sitonic on Slack, he will be able to create your database credential.
Datajoint will then use those credentials to login into the database and allow you to use it.</p>
<p>This is the basic setup of the login information for datajoint. This only needs to be run once per computer.
In Docker this is done by setting the enviorment variables which datajoint will use (more details on K8 stuff)</p>
<p>pip3:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datajoint</span> <span class="k">as</span> <span class="nn">dj</span>

<span class="n">dj</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;database.host&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;at-database1.ad.bcm.edu&#39;</span> <span class="c1"># This the database server, yes you must VPN into Baylor</span>
<span class="n">dj</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;database.user&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;yourusername&#39;</span> <span class="c1"># Provided when you setup an account with Daniel</span>
<span class="n">dj</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;database.password&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;NotMyRealPassword&#39;</span> <span class="c1"># Provided when you setup an account with Daniel</span>

<span class="n">dj</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">save_global</span><span class="p">()</span> <span class="c1"># Save the information above on your machine so you don&#39;t have to do this again.</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="overview-of-the-basics-of-datajoint">
<h2>Overview of the Basics of DataJoint<a class="headerlink" href="#overview-of-the-basics-of-datajoint" title="Permalink to this headline">¶</a></h2>
<p>DataJoint has several table classes that serves as the bases for all tables the user will need:</p>
<ul class="simple">
<li><p>dj.Manual</p></li>
<li><p>dj.Computed</p></li>
<li><p>dj.Lookup</p></li>
<li><p>dj.Imported</p></li>
<li><p>dj.Part</p></li>
</ul>
<p>We will mostly only focus on the dj.Manual, dj.Computed, and dj.Lookup</p>
</div>
<div class="section" id="schema">
<h2>Schema<a class="headerlink" href="#schema" title="Permalink to this headline">¶</a></h2>
<p>Each table in the database belongs to something call a schema which is a logical representation of database. In short each schema has a collection of
tables which can only be access via that schema.</p>
<p>In datajoint, to select what schema the table should be place under, datajoint uses class decarators:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datajoint</span> <span class="k">as</span> <span class="nn">dj</span>

<span class="n">schema</span> <span class="o">=</span> <span class="n">dj</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span><span class="s1">&#39;synicix_datajoint_tutorial&#39;</span><span class="p">)</span> <span class="c1"># This is how you set the schema</span>

<span class="c1"># Example Manual table, more detail explinations on the following sections</span>
<span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Student</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    student_id : int unsigned</span>
<span class="s2">    ---</span>
<span class="s2">    first_name : varchar(64)</span>
<span class="s2">    last_name : varchar(64)</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</td></tr></table></div>
<p><strong>NOTE: By default the user are only given permission to create and access schemas with user_*, all other schemas access permission must go through Daniel</strong></p>
</div>
<div class="section" id="table-definition">
<h2>Table Definition<a class="headerlink" href="#table-definition" title="Permalink to this headline">¶</a></h2>
<p>For each table define in datajoint, there are a set of primary and non-primary attributes (columns) that is use to define what is contain inside of the table where primary
attributes are what uniquely identify each tuple.</p>
<p>In datajoint table, each class has a field call definition, which define the primary and non-primary attributes of the table as well as its datatype.
Every attributes that is define above “- - -” (line 10) is consider to be primary, while everything below is not.</p>
<p>Each attributes the attribute name on the left followed by “:” then the datatype of the attribute.
Details on the datatypes can be found in the next section.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datajoint</span> <span class="k">as</span> <span class="nn">dj</span>

<span class="n">schema</span> <span class="o">=</span> <span class="n">dj</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span><span class="s1">&#39;synicix_datajoint_tutorial&#39;</span><span class="p">)</span> <span class="c1"># This is how you set the schema</span>

<span class="c1"># Example Manual table, more detail explinations on the following sections</span>
<span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Student</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    student_id : int unsigned</span>
<span class="s2">    ---</span>
<span class="s2">    first_name : varchar(64)</span>
<span class="s2">    last_name : varchar(64)</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</td></tr></table></div>
<p>One important note about primary attributes are index, meaning any restrictions are join done on those attributes are vastly faster then on non-primary attributes</p>
<p>Also for tips in designing primary attributes, if the table have a lot of primary key attributes, it will probably be better to do an MD5 hash in those cases, but this varies.</p>
</div>
<div class="section" id="data-types">
<h2>Data Types<a class="headerlink" href="#data-types" title="Permalink to this headline">¶</a></h2>
<p>These are the datatype that datajoint supports:</p>
<ul class="simple">
<li><p><strong>tinyint:</strong> an 8-bit integer number, ranging from -128 to 127.</p></li>
<li><p><strong>tinyint unsigned:</strong> an 8-bit positive integer number, ranging from 0 to 255.</p></li>
<li><p><strong>smallint:</strong> a 16-bit integer number, ranging from -32,768 to 32,767.</p></li>
<li><p><strong>smallint unsigned:</strong> a 16-bit positive integer, ranging from 0 to 65,535.</p></li>
<li><p><strong>int:</strong> a 32-bit integer number, ranging from -2,147,483,648 to 2,147,483,647.</p></li>
<li><p><strong>int unsigned:</strong> a 32-bit positive integer, ranging from 0 to 4,294,967,295.</p></li>
<li><p><strong>enum:</strong> one of several explicitly enumerated values specified as strings. Use this datatype instead of text strings to avoid spelling variations and to save storage space. For example, for anesthesia, the datatype could be enum(“urethane”, “isoflurane”, “fentanyl”). Do not use enums in primary keys due to the difficulty of changing their definitions consistently in multiple tables.</p></li>
<li><p><strong>date:</strong> date as ‘YYYY-MM-DD’.</p></li>
<li><p><strong>time:</strong> time as ‘HH:MM:SS’.</p></li>
<li><p><strong>timestamp:</strong> Date and time to the second as ‘YYYY-MM-DD HH:MM:SS’. The default value may be set to CURRENT_TIMESTAMP.</p></li>
<li><p><strong>char(N):</strong> a character string up to N characters (but always takes the entire N bytes to store).</p></li>
<li><p><strong>varchar(N):</strong> a text string of arbitrary length up to N characters that takes N+1 or N+2 bytes of storage.</p></li>
<li><p><strong>float:</strong> a single-precision floating-point number. Takes 4 bytes. Single precision is sufficient for many measurements.</p></li>
<li><p><strong>double:</strong> a double-precision floating-point number. Takes 8 bytes. Because equality comparisons are error-prone, neither float nor double should be used in primary keys.</p></li>
<li><p><strong>decimal(N,F):</strong> a fixed-point number with N total decimal digits and F fractional digits. This datatype is well suited to represent numbers whose magnitude is well defined and does not warrant the use of floating-point representation or requires precise decimal representations (e.g. dollars and cents). Because of its well-defined precision, decimal values can be used in equality comparison and be included in primary keys.</p></li>
<li><p><strong>longblob:</strong> arbitrary MATLAB value (e.g. matrix, image, structure), up to 4 GiB in size. In Python, arbitrary numeric numpy array. Numeric arrays are compatible between MATLAB and Python.</p></li>
<li><p><strong>decimal(N,F) unsigned:</strong> same as decimal, but limited to nonnegative values.</p></li>
<li><p><strong>mediumint:</strong> a 24-bit integer number, ranging from -8,388,608 to 8,388,607.</p></li>
<li><p><strong>mediumint unsigned:</strong> a 24-bit positive integer, ranging from 0 to 16,777,216.</p></li>
</ul>
</div>
<div class="section" id="external-storage">
<h2>External Storage<a class="headerlink" href="#external-storage" title="Permalink to this headline">¶</a></h2>
<p>There are many use cases where the storage of large arrays of floats, ints, etc. is needed, however through storing it in a longblob datatype works, there are several disadvantagoues that should be considered.
All longblobs are stored direclty into the database server, meaning it can be very easy to fill up the storage on the database server causing many issues down the line. The other major problem is that each time there is a request
to fetch the longblob, the database has to handle that which will bogged down the IO performance on the server.</p>
<p>External-storage is a datatype that datajoint provides that allow the storage of large numerical arrays to be stored on a external storage location like an network storage server instead of directly on the database server.
This allows user to store massive amount of data without filling up the database, which will cause serveral problems down the line. In short it works exactly like longblob except with the
addition of requirement of telling datajoint where the external storage is located.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># external-storage has to be configure each time you load the definition and be accessable from the machine you are running from</span>
<span class="n">dj</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;external-storage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">protocol</span><span class="o">=</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s1">&#39;/mnt/scratch07/datajoint_quick_introduction&#39;</span><span class="p">)</span>

<span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">ScanData</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    scan_id : int unsigned</span>
<span class="s2">    ---</span>
<span class="s2">    scan_data : external-storage</span>
<span class="s2">    &quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">ScanData</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">scan_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">scan_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">))))</span> <span class="c1"># works just like longblob</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="migrating-external-storage-from-v0-11-to-v0-12">
<h2>Migrating External Storage from v0.11 to v0.12<a class="headerlink" href="#migrating-external-storage-from-v0-11-to-v0-12" title="Permalink to this headline">¶</a></h2>
<p>Due to internal changes, External Storage from v0.12 and are no longer compatible with v0.11 and below.
Here are the instructions on how to do the migration:</p>
<p><a class="reference external" href="https://docs.datajoint.io/python/admin/5-blob-config.html?highlight=migrating#migration-between-datajoint-v0-11-and-v0-12">https://docs.datajoint.io/python/admin/5-blob-config.html?highlight=migrating#migration-between-datajoint-v0-11-and-v0-12</a></p>
</div>
<div class="section" id="dj-manual">
<h2>dj.Manual<a class="headerlink" href="#dj-manual" title="Permalink to this headline">¶</a></h2>
<p>dj.Manual tables that require the manual insertion of tuples by the users, this doesn’t neccesearly mean fully manual as the user can right a method to do the insertion for them base on the provided parameteres.
In our convention we often call this method fill. This is not a programmatic requirement, just the convention we use in the lab.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Setting up schema</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">dj</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span><span class="s1">&#39;synicix_datajoint_tutorial&#39;</span><span class="p">)</span>

<span class="c1"># dj.Manual table definition</span>
<span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Student</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    student_id : int unsigned</span>
<span class="s2">    ---</span>
<span class="s2">    first_name : varchar(64)</span>
<span class="s2">    last_name : varchar(64)</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="c1"># Example of user define function</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fill</span><span class="p">(</span><span class="n">num_of_tuples_to_insert</span><span class="p">):</span>\
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to insert 10 example tuples into the table Student. Also please document your functions</span>
<span class="sd">        in this format so Sphnix can auto docs for you later.</span>

<span class="sd">        Args:</span>
<span class="sd">            num_of_tuples_to_insert (int): number of tuples to insert into the Student table</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Note that the key values of the dict must match the attribute names in the table</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_of_tuples_to_insert</span><span class="p">):</span>
            <span class="c1"># Create a dictionary with corresponding keys to the table we are inserting</span>
            <span class="n">dict_to_insert</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">student_id</span> <span class="o">=</span> <span class="n">i</span><span class="p">,</span>
            <span class="n">first_name</span> <span class="o">=</span> <span class="s1">&#39;Daniel&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
            <span class="n">last_name</span> <span class="o">=</span> <span class="s1">&#39;Sitonic&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

            <span class="n">Student</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">dict_to_insert</span><span class="p">)</span> <span class="c1"># Inserting the tuple into the Student Table</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="dj-computed">
<h2>dj.Computed<a class="headerlink" href="#dj-computed" title="Permalink to this headline">¶</a></h2>
<p>dj.Computed tables are very similar to dj.Manual execpt that instead of inserting each entry manually, the entry
will be instead computed from a pre-define function that the user wrote, hence the the name computed.</p>
<p>There is two main distictions that a dj.computed tables has verses it dj.Manual counter part:</p>
<ul class="simple">
<li><p>Foreign Key Reference: Computed table tend to reference the primary attributes from another table where for each primary key serves as the input parameteres for the computation define by the user in the make function.</p></li>
<li><p>make(self, key) function: This function is where the user defines his or her computation where the key being passed in forgien key reference or references define in the computed table definition.</p></li>
</ul>
<p>These two work together to establish a computation data pipeline which is the main purpose of datajoint.
For example, a typical pipeline might look something like this: Scan Data -&gt; Post-Scan Processing Comptuation -&gt; Processed Data for Data Analysis -&gt; etc.</p>
<p>The other major feature of dj.Computed tables is that it can serve as a synchonize and atomic job queue for multiple instances of your application via
the populate function which is called to start the computation of each row. This is particularly useful in cases with
Kubernetes cluster deployment where you can deploy like a 1000+ instances of the application where datajoint will handle
telling each instance what key they should do their computation on so that there is no overlap.</p>
<p>Here is an example dj.Computed table:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datajoint</span> <span class="k">as</span> <span class="nn">dj</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">schema</span> <span class="o">=</span> <span class="n">dj</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span><span class="s1">&#39;synicix_datajoint_tutorial&#39;</span><span class="p">)</span>

<span class="c1"># dj.Manual table that will serve as the parent table for the computed table</span>
<span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">ScanData</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    scan_id : int unsigned</span>
<span class="s2">    ---</span>
<span class="s2">    scan_data : longblob</span>
<span class="s2">    &quot;&quot;&quot;</span>

<span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">ProcessedScanData</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Computed</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; ScanData # Forigen Key Reference</span>
<span class="s2">    ---</span>
<span class="s2">    processed_scan_data : longblob</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function that computes processed_scan_data which is 2 * scan data from the ScanData Table</span>

<span class="sd">        Args:</span>
<span class="sd">            key(dict) : dictionary that contains the primary key of ScanData to do computation on</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">scan_data_dict</span> <span class="o">=</span> <span class="p">(</span><span class="n">ScanData</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">()</span> <span class="c1"># Get all attributes of the tuple entry (More details on the syntax in the Querying Tables section)</span>
        <span class="n">key</span><span class="p">[</span><span class="s1">&#39;processed_scan_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scan_data_dict</span><span class="p">[</span><span class="s1">&#39;scan_data&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="c1"># Get the scan_data array and multiply by 2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="c1"># Insert the key which now has all the require attributes to insert into ProcessedScanData</span>

<span class="c1"># Some example usage</span>
<span class="n">ScanData</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">scan_id</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scan_data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span> <span class="c1"># Insert 1 tuple into Scan Data</span>
<span class="n">ProcessedScanData</span><span class="o">.</span><span class="n">populate</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="querying-tables">
<h2>Querying Tables<a class="headerlink" href="#querying-tables" title="Permalink to this headline">¶</a></h2>
<p>Getting data as well as applying simple restrictions on the tables is very simple with datajoint.
Take a look at the examples below:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datajoint</span> <span class="k">as</span> <span class="nn">dj</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">schema</span> <span class="o">=</span> <span class="n">dj</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span><span class="s1">&#39;synicix_datajoint_tutorial&#39;</span><span class="p">)</span>

<span class="c1"># dj.Manual table that will serve as the parent table for the computed table</span>
<span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">ScanData</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    scan_id : int unsigned</span>
<span class="s2">    ---</span>
<span class="s2">    scan_data : longblob</span>
<span class="s2">    &quot;&quot;&quot;</span>

<span class="c1"># Inserting a few tuples into the table</span>
<span class="n">ScanData</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">scan_id</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scan_data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>
<span class="n">ScanData</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">scan_id</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">scan_data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>

<span class="c1"># Querying the table to see what entires are there</span>
<span class="n">ScanData</span><span class="p">()</span>

<span class="c1"># Get all the tuples in ScanData as an array of tuples</span>
<span class="n">ScanData</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>

<span class="c1"># Get all the tuples as a list of dict</span>
<span class="n">ScanData</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Restricting ScanData tuples by the condition where scan_id == 5 with restriction by a dict</span>
<span class="n">ScanData</span><span class="p">()</span> <span class="o">&amp;</span> <span class="nb">dict</span><span class="p">(</span><span class="n">scan_id</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Alternative way of doing it</span>
<span class="c1"># (Note that for string the value should be surronded by &quot;&quot; i.e. &#39;str_attr=&quot;asdfjl&quot;&#39;, but in general try to avoid doing restrictions on varchar and longblob as those are expensive)</span>
<span class="n">ScanData</span><span class="p">()</span> <span class="o">&amp;</span> <span class="s1">&#39;scan_id=5&#39;</span>

<span class="c1"># If the restriction results in only 1 tuple then we can do fetch1</span>
<span class="p">(</span><span class="n">ScanData</span> <span class="o">&amp;</span> <span class="s1">&#39;scan_id=5&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">()</span> <span class="c1"># Return a dict</span>

<span class="c1"># For more complicated restrictions such as getting scan_id &lt; 6</span>
<span class="n">ScanData</span><span class="p">()</span> <span class="o">&amp;</span> <span class="s1">&#39;scan_id &lt; 5&#39;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="datajoint-parallelizing-dj-computed-populate">
<h2>DataJoint Parallelizing dj.Computed Populate<a class="headerlink" href="#datajoint-parallelizing-dj-computed-populate" title="Permalink to this headline">¶</a></h2>
<p>Often times there is a need to parallelize the population of a dj.Computed table, such as when each tuple takes considerable amount of time to compute.
DataJoint offers a solution with this something call a jobs table which is tied to the schema that the dj.Computed table is under.</p>
<p>To use it all we need to add an argument call reserved_jobs=True when we call .populate() function for a computed table. i.e.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datajoint</span> <span class="k">as</span> <span class="nn">dj</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">schema</span> <span class="o">=</span> <span class="n">dj</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span><span class="s1">&#39;synicix_datajoint_tutorial&#39;</span><span class="p">)</span>

<span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">ScanData</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    scan_id : int unsigned</span>
<span class="s2">    ---</span>
<span class="s2">    scan_data : longblob</span>
<span class="s2">    &quot;&quot;&quot;</span>

<span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">ProcessedScanData</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Computed</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; ScanData # Forigen Key Reference</span>
<span class="s2">    ---</span>
<span class="s2">    processed_scan_data : longblob</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function that computes processed_scan_data which is 2 * scan data from the ScanData Table</span>

<span class="sd">        Args:</span>
<span class="sd">            key(dict) : dictionary that contains the primary key of ScanData to do computation on</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">scan_data_dict</span> <span class="o">=</span> <span class="p">(</span><span class="n">ScanData</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">()</span>
        <span class="n">key</span><span class="p">[</span><span class="s1">&#39;processed_scan_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scan_data_dict</span><span class="p">[</span><span class="s1">&#39;scan_data&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<span class="n">ScanData</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">scan_id</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scan_data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>
<span class="n">ProcessedScanData</span><span class="o">.</span><span class="n">populate</span><span class="p">(</span><span class="n">reserved_jobs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Only change that is needed</span>
</pre></div>
</td></tr></table></div>
<p>In short the basic work flow is of the populate function call with reserved_jobs=True is</p>
<ul class="simple">
<li><p>Find out what tuples need to me populate by querying the key_source of the current compute table and removing the tuples that already been completed or is currently reserved by a another populate instance</p></li>
<li><p>Get one of the tuples that needs to be populate and tell the database to reserve it, thus marking it as reserved in the schema.jobs table</p></li>
<li><p>Upon completion of the computation, remove the tuple from the schema.jobs table.</p></li>
</ul>
<p>To access the schema.jobs tables simply have the schema define somewhere and query the table</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datajoint</span> <span class="k">as</span> <span class="nn">dj</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">schema</span> <span class="o">=</span> <span class="n">dj</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span><span class="s1">&#39;synicix_datajoint_tutorial&#39;</span><span class="p">)</span>

<span class="n">schema</span><span class="o">.</span><span class="n">jobs</span>
</pre></div>
</td></tr></table></div>
<p>There are times where a bug slips through and causes run times errors, creating a nightmare to debug espically when running mutiple instances.
In order to assist with the debugging process, datajoint populate function logs every errored instances into the schema.jobs table, though it won’t log the full stack trace,
it does log the last message. <strong>Just note that if the tuple is logged as an errored tuple populate attempt in the schema.jobs table, it won’t populate that tuple until it is deleted manually.</strong></p>
</div>
<div class="section" id="other-resources">
<h2>Other Resources:<a class="headerlink" href="#other-resources" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">DataJoint Full Documentation: <a class="reference external" href="https://docs.datajoint.io/python/">https://docs.datajoint.io/python/</a> n</div>
<div class="line">GitHub: <a class="reference external" href="https://github.com/datajoint/datajoint-python">https://github.com/datajoint/datajoint-python</a></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="docker.html" class="btn btn-neutral float-right" title="Docker" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to atlab-docs’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, Synicix

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>